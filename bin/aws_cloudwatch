#!/usr/bin/env python
import boto.ec2.cloudwatch
import datetime
import time
import sys

#import pprint

c = boto.ec2.cloudwatch.connect_to_region(boto.ec2.cloudwatch.CloudWatchConnection.DefaultRegionName)

namespace = 'AWS/RDS'
idDimension = sys.argv[1]

metrics = c.list_metrics(namespace=namespace, dimensions={ 'DBInstanceIdentifier' : idDimension })

end=datetime.datetime.utcnow()
start =  end - datetime.timedelta(seconds=600)

print "<<<cloudwatch>>>"

datapoints = [ (m, m.query(start, end, m.Statistics, None)) for m in metrics ]
for (m, q) in datapoints:
    if (q):
        r = sorted(q, key = lambda k: k['Timestamp'], reverse = True)[0]
	print m.name, r['Timestamp'].isoformat(), r['SampleCount'], r['Unit'], r['Average'], r['Maximum'], r['Minimum'], r['Sum']
